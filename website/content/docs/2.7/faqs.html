

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frequently Asked Questions &mdash; software-factory  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="software-factory  documentation" href="index.html"/>
        <link rel="prev" title="Contributor documentation" href="contributor/index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> software-factory
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main_components.html">Main components</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/index.html">User documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_config/index.html">The Config repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator/index.html">Operator documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/index.html">Contributor documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-the-added-value-of-software-factory">What is the added value of Software Factory ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#can-i-disable-gerrit">Can I disable Gerrit ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-can-t-i-2-a-change-after-being-added-to-the-core-group">Why can’t I +2 a change after being added to the core group ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-does-my-build-fail-with-the-not-registered-error">Why does my build fail with the “NOT_REGISTERED” error ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-does-my-build-stay-in-queued-state">Why does my build stay in “queued” state ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-change-my-deployment-s-hostname">How can I change my deployment’s hostname?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-setup-a-mirror-on-swift-for-external-dependencies">How to setup a mirror on swift for external dependencies ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-restart-zuul-without-losing-builds-in-progress">How to restart zuul without losing builds in progress ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-use-the-gerrit-rest-api">How can I use the Gerrit REST API?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-can-i-use-gertty">How can I use Gertty?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">software-factory</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Frequently Asked Questions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/faqs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-the-added-value-of-software-factory">
<h2>What is the added value of Software Factory ?<a class="headerlink" href="#what-is-the-added-value-of-software-factory" title="Permalink to this headline">¶</a></h2>
<p>If you are not sure about using Software Factory, here are some perks that might
convince you:</p>
<ul class="simple">
<li>Software Factory is a Continuous Integration system that works out of the box, with everything ready to be used right after the first configuration run.
Deploying all the services by hand and with this level of interdependency would take a lot more time.</li>
<li>Software Factory helps enforcing the latest best practices in Continuous Integration.</li>
<li>In Software Factory, the configuration is treated as code that can therefore be versioned, reviewed, tested or rolled back for any change.</li>
<li>Users are automatically and consistently authenticated on each service with Single Sign-On. Again, achieving this by hand would be very time consuming.</li>
<li>Software Factory can be fully backed up, restored, and upgraded automatically through tested processes.</li>
<li>Software Factory can be deployed anywhere: baremetal systems, LXC, KVM or on OpenStack via Heat.</li>
<li>Software Factory is fast to deploy (3/5 minutes on a local system, 15 minutes with Heat).</li>
<li>Software Factory runs worker nodes on demand on an OpenStack cloud, which can reduce effective costs of testing.</li>
</ul>
</div>
<div class="section" id="can-i-disable-gerrit">
<h2>Can I disable Gerrit ?<a class="headerlink" href="#can-i-disable-gerrit" title="Permalink to this headline">¶</a></h2>
<p>As of now, Gerrit is mandatory in Software Factory for a couple of reasons:</p>
<ul class="simple">
<li>Managesf access control policies are based on Gerrit groups.</li>
<li>The config repository is hosted on Gerrit with an integrated CI/CD workflow.</li>
</ul>
<p>Gerrit will be made optional in a future release <a class="footnote-reference" href="#id2" id="id1">[1]</a> of Software Factory</p>
<p>Note that it is possible to use Software Factory as a third party CI for
an external Gerrit or a GitHub organization. In this case, the gerrit server
is only used to host the config repository, and operators can bypass it
entirely by pushing config repository changes with the “git push” command
instead of “git review”.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>To be determined</td></tr>
</tbody>
</table>
</div>
<div class="section" id="why-can-t-i-2-a-change-after-being-added-to-the-core-group">
<h2>Why can’t I +2 a change after being added to the core group ?<a class="headerlink" href="#why-can-t-i-2-a-change-after-being-added-to-the-core-group" title="Permalink to this headline">¶</a></h2>
<p>This may happen because of web browser cache issues. Remove all
cookies then log out and log in again to refresh your gerrit privileges.</p>
</div>
<div class="section" id="why-does-my-build-fail-with-the-not-registered-error">
<h2>Why does my build fail with the “NOT_REGISTERED” error ?<a class="headerlink" href="#why-does-my-build-fail-with-the-not-registered-error" title="Permalink to this headline">¶</a></h2>
<p>This error happens when zuul can’t build a job. Most of the time it’s because:</p>
<ul class="simple">
<li>A project gate is configured with an unknown job. The job’s definition
is likely missing in zuul’s layout.</li>
<li>No worker node was ever available. Zuul will fail throwing a NOT_REGISTERED error
(instead of queuing) until a worker node with the correct label is available.
Only then, once Zuul knows a label really exists, will it properly queue builds.</li>
</ul>
<p>The first step to investigate that error is to verify that the job is present
in the jobs dashboard. If the job is not there, check the config repository and check
that the job is either expanded from a job template (using the project’s name),
or that is fully defined. Otherwise add the job and update the config repository.</p>
</div>
<div class="section" id="why-does-my-build-stay-in-queued-state">
<h2>Why does my build stay in “queued” state ?<a class="headerlink" href="#why-does-my-build-stay-in-queued-state" title="Permalink to this headline">¶</a></h2>
<p>This happens when no worker nodes are available to execute a build:</p>
<ul class="simple">
<li>First verify that at least one worker node with the right label exists. You can list nodes
with the sfmanager CLI.</li>
<li>Then verify that your job definition actually uses the right worker node label.</li>
</ul>
</div>
<div class="section" id="how-can-i-change-my-deployment-s-hostname">
<h2>How can I change my deployment’s hostname?<a class="headerlink" href="#how-can-i-change-my-deployment-s-hostname" title="Permalink to this headline">¶</a></h2>
<p>You can change the hostname after the deployment by changing the fqdn parameter
in /etc/software-factory/sfconfig.yaml, removing the existing SSL certificates
(only required if running functional tests and using the default self-signed
certificates) and running sfconfig again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sed -i -e <span class="s1">&#39;s/fqdn:.*/fqdn: mynewhostname.com/g&#39;</span> /etc/software-factory/sfconfig.yaml
sfconfig
</pre></div>
</div>
<p>Please note that you might need to update URLs in other places as well, for
example git remote urls in .gitreview and .git/config files for repositories
hosted on Software Factory.</p>
</div>
<div class="section" id="how-to-setup-a-mirror-on-swift-for-external-dependencies">
<h2>How to setup a mirror on swift for external dependencies ?<a class="headerlink" href="#how-to-setup-a-mirror-on-swift-for-external-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The mirror service uses the mirror2swift utility to provide a local cache
for external ressources. For example we use it to mirror RPM repositories,
which speeds up building times of our test environments.</p>
<p>To enable the mirror service, you need to configure a swift container
in sfconfig.yaml and then specify the URL to mirror in the config-repo:</p>
<ul class="simple">
<li>Add the <strong>mirror</strong> role to /etc/software-factory/arch.yaml</li>
<li>Configure the mirror role in /etc/software-factory/sfconfig.yaml</li>
<li>Run sfconfig</li>
<li>Edit the mirror configuration template provided in the <em>mirrors</em> directory of
the config repository.</li>
</ul>
<p>When <strong>periodic_update</strong> is set, the mirror will be updated periodically
through a dedicated zuul pipeline. The status of the update can be checked like any
other CI build. Otherwise, to update the cache manually, this command needs to be
executed:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo -u mirror2swift mirror2swift /var/lib/mirror2swift/config.yaml
</pre></div>
</div>
<p>sfconfig.yaml example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mirrors</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">periodic_update</span><span class="p p-Indicator">:</span> <span class="s">&#39;0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">\*&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">swift_mirror_url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://swift:8080/v1/AUTH_uuid/repomirror/</span>
  <span class="l l-Scalar l-Scalar-Plain">swift_mirror_tempurl_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TEMP_URL_KEY</span>
</pre></div>
</div>
<p>The swift_mirror_url needs to be the canonical, fully qualified url of the target container.
The swift_mirror_tempurl_key needs to be a tempurl key with writing rights.
The periodic_update needs to be a valid zuul timer format, e.g. daily is ‘0 0 * * *’.</p>
<p>The yaml files in the config repository represent the list of mirrors as documented here:
<a class="reference external" href="https://github.com/cschwede/mirror2swift">https://github.com/cschwede/mirror2swift</a>. For example, config/mirrors/centos.yaml:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">os</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">repodata</span>
  <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="s">&#39;http://centos.mirror.example.com/7/os/x86_64/&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">prefix</span><span class="p p-Indicator">:</span> <span class="s">&#39;os/&#39;</span>
</pre></div>
</div>
<p>This will mirror the CentOS-7 base repository to <a class="reference external" href="http://swift:8080/v1/AUTH_uuid/repomirror/os/">http://swift:8080/v1/AUTH_uuid/repomirror/os/</a></p>
</div>
<div class="section" id="how-to-restart-zuul-without-losing-builds-in-progress">
<h2>How to restart zuul without losing builds in progress ?<a class="headerlink" href="#how-to-restart-zuul-without-losing-builds-in-progress" title="Permalink to this headline">¶</a></h2>
<p>The zuul service is stateless and stopping the process will lose track
of running jobs. However the zuul-changes.py utility can be used
to save and restore the current state:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Print and save all builds in progress to /var/lib/zuul/zuul-queues-dump.sh</span>
/usr/share/sf-config/scripts/zuul-changes.py dump

systemctl restart zuul-server

<span class="c1"># Reload the previous state:</span>
/usr/share/sf-config/scripts/zuul-changes.py load
</pre></div>
</div>
<p>The periodic and post pipelines are not dumped by this tool.</p>
</div>
<div class="section" id="how-can-i-use-the-gerrit-rest-api">
<span id="gerrit-rest-api"></span><h2>How can I use the Gerrit REST API?<a class="headerlink" href="#how-can-i-use-the-gerrit-rest-api" title="Permalink to this headline">¶</a></h2>
<p>The Gerrit REST API is open for queries by default on all Software Factory deployments.
There is an extensive documentation available online:</p>
<blockquote>
<div><a class="reference external" href="https://gerrit-review.googlesource.com/Documentation/rest-api.html">https://gerrit-review.googlesource.com/Documentation/rest-api.html</a></div></blockquote>
<p>To use the Gerrit REST API in Software Factory, you have to create an API
password first. To do so, go to the <strong>User Settings</strong> page (upper right corner on the top menu)
and click the Enable button for “Gerrit API key”.</p>
<p>The Gerrit API is available at the following endpoint:</p>
<blockquote>
<div><a class="reference external" href="https://fqdn/api/">https://fqdn/api/</a></div></blockquote>
<p>and for authenticated requests, using the API password:</p>
<blockquote>
<div><a class="reference external" href="https://fqdn/api/a/">https://fqdn/api/a/</a></div></blockquote>
<p>For example, getting open, watched changes on the default deployment with cURL would be:</p>
<blockquote>
<div>curl -X GET <a class="reference external" href="http://sftests.com/api/changes/?q=status:open+is:watched&amp;n=2">http://sftests.com/api/changes/?q=status:open+is:watched&amp;n=2</a></div></blockquote>
<p>You can find a full working example to automate some tasks (in this case deleting a specific branch
on a list of projects) in <cite>tools/deletebranches.py</cite>.</p>
</div>
<div class="section" id="how-can-i-use-gertty">
<h2>How can I use Gertty?<a class="headerlink" href="#how-can-i-use-gertty" title="Permalink to this headline">¶</a></h2>
<p>After getting a Gerrit API key (as explained <a class="reference internal" href="#gerrit-rest-api"><span class="std std-ref">above</span></a>), use
the <em>basic</em> auth-type in gertty.yaml, e.g.:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">servers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sftests</span>
    <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">https://sftests.com/api/</span>
    <span class="l l-Scalar l-Scalar-Plain">git-url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ssh://USER_NAME@sftests.com:29418</span>
    <span class="l l-Scalar l-Scalar-Plain">auth-type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">basic</span>
    <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">USER_NAME</span>
    <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">API_KEY</span>
    <span class="l l-Scalar l-Scalar-Plain">git-root</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~/git/</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="contributor/index.html" class="btn btn-neutral" title="Contributor documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Red Hat.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>