

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Nodepool configuration &mdash; software-factory  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="software-factory  documentation" href="../index.html"/>
        <link rel="up" title="The Config repository" href="index.html"/>
        <link rel="next" title="Operator documentation" href="../operator/index.html"/>
        <link rel="prev" title="Zuul pipelines and gating configuration" href="zuul_user.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> software-factory
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../main_components.html">Main components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Config repository</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="resources_user.html">Managing resources via the config repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="zuul3_user.html">Zuul3 user documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodepool3_user.html">Nodepool3 user documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="gerritbot_user.html">Gerritbot notification channels configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="gerrit_replication_user.html">Configure Gerrit git repositories replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="access_control_user.html">API access control</a></li>
<li class="toctree-l2"><a class="reference internal" href="gerritlinks_user.html">Gerrit comments link customisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="repoxplorer_user.html">RepoXplorer</a></li>
<li class="toctree-l2"><a class="reference internal" href="jenkins_user.html">Jenkins jobs configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="zuul_user.html">Zuul pipelines and gating configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Nodepool configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-extra-elements">Using extra elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-elements">Adding custom elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cli">CLI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operator/index.html">Operator documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributor/index.html">Contributor documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">software-factory</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">The Config repository</a> &raquo;</li>
        
      <li>Nodepool configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/project_config/nodepool_user.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning" id="nodepool-user">
<p class="first admonition-title">Warning</p>
<p class="last">Nodepool (v2) is deprecated and will be removed in Software Factory 3.0</p>
</div>
<div class="section" id="nodepool-configuration">
<h1>Nodepool configuration<a class="headerlink" href="#nodepool-configuration" title="Permalink to this headline">¶</a></h1>
<p>Disk images and labels definitions are set in Software Factory’s <strong>config</strong> repository.</p>
<p>Clone the config repository and modify the file “config/nodepool/nodepool.yaml”
as shown below:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">diskimages</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dib-centos-7</span>
    <span class="l l-Scalar l-Scalar-Plain">elements</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">centos-minimal</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nodepool-minimal</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sf-zuul-worker</span>

<span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">centos-7</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">centos-7</span>
    <span class="l l-Scalar l-Scalar-Plain">min-ready</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>

<span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">cloud</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">clean-floating-ips</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">image-type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">raw</span>
    <span class="l l-Scalar l-Scalar-Plain">max-servers</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class="l l-Scalar l-Scalar-Plain">boot-timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">120</span>
    <span class="l l-Scalar l-Scalar-Plain">pool</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nova</span>
    <span class="l l-Scalar l-Scalar-Plain">rate</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10.0</span>
    <span class="l l-Scalar l-Scalar-Plain">networks</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">slave-net-name</span>
    <span class="l l-Scalar l-Scalar-Plain">images</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">centos-7</span>
        <span class="l l-Scalar l-Scalar-Plain">diskimage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dib-centos-7</span>
        <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
        <span class="l l-Scalar l-Scalar-Plain">min-ram</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1024</span>
</pre></div>
</div>
<p>When submitting this change to the config repository, Software Factory will perform a syntax
check and will allow you (or not) to merge the change. Once merged
the new configuration will be loaded by the Nodepool service. This will trigger
the following on the cloud provider(s) if relevant:</p>
<blockquote>
<div><ul class="simple">
<li>A VM is spawned (with “template” in its name)</li>
<li>After the execution of the <em>base.sh</em> script, a snapshot of the VM is created</li>
<li>The VM is destroyed and the snapshot is made available</li>
<li>At least one VM is spawned based on the snapshot</li>
<li>A floating ip is attached to the new VM</li>
<li>The new VM is attached to the build executor as a worker node</li>
</ul>
</div></blockquote>
<p>Using the config repository, Software Factory users can provide their own build scripts for
specific worker nodes as well as custom labels for their jobs’ needs. The worker nodes
are used only once for one specific build, and are destroyed upon the build’s completion.
This has several advantages:</p>
<blockquote>
<div><ul class="simple">
<li>A clean, reproducible environment for each build</li>
<li>A job may have full system access (root) with interfering with anything else</li>
<li>Better resource management as nodes are only up when needed</li>
</ul>
</div></blockquote>
<div class="section" id="using-extra-elements">
<span id="diskimage-elements"></span><h2>Using extra elements<a class="headerlink" href="#using-extra-elements" title="Permalink to this headline">¶</a></h2>
<p>All <a class="reference external" href="https://docs.openstack.org/developer/diskimage-builder/elements.html">diskimage-builder elements</a>
as well as <a class="reference external" href="https://softwarefactory-project.io/r/gitweb?p=software-factory/sf-elements.git;a=tree;f=elements">sf-elements</a>
are available to define a nodepool image. For example you can:</p>
<ul class="simple">
<li>Replace <em>centos7</em> by <em>fedora</em> or <em>gentoo</em> to change the base OS</li>
<li>Use <em>selinux-permissive</em> to set selinux in permissive mode</li>
<li>Use <em>pip-and-virtualenv</em> to install packages from PyPI</li>
<li>Use <em>source-repositories</em> to provision a git repository</li>
</ul>
</div>
<div class="section" id="adding-custom-elements">
<h2>Adding custom elements<a class="headerlink" href="#adding-custom-elements" title="Permalink to this headline">¶</a></h2>
<p>To customize an image, new diskimage builder elements can be added to the <strong>nodepool/elements</strong> directory in the config repository.
For example, to add python 3.4 to a CentOS-based system, you need to create this element:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir nodepool/elements/python34-epel
<span class="nb">echo</span> -e <span class="s1">&#39;epel\npackage-installs&#39;</span> &gt; nodepool/elements/python34-epel/element-deps
<span class="nb">echo</span> <span class="s1">&#39;python34:&#39;</span> &gt; nodepool/elements/python34-epel/packages.yaml
</pre></div>
</div>
<p>Then you can add the ‘python34-epel’ element to an existing image.</p>
<p>Read more about diskimage builder elements <a class="reference external" href="https://docs.openstack.org/developer/diskimage-builder/developer/developing_elements.html">here</a>.
Or look at examples from <a class="reference external" href="https://softwarefactory-project.io/r/gitweb?p=software-factory/sf-elements.git;a=tree;f=elements">sf-elements</a>.</p>
</div>
<div class="section" id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this headline">¶</a></h2>
<p>The CLI utility <em>sfmanager</em> can be used to interact with nodes that are currently running. The
following actions are supported:</p>
<ul class="simple">
<li>list nodes, with status information like id, state, age, ip address, base image</li>
<li>hold a specific node, so that it is not destroyed after it has been consumed for a build</li>
<li>add a SSH public key to the list of authorized keys on the node, allowing a user to do
remote operations on the node</li>
<li>schedule a node for deletion</li>
<li>list available images</li>
</ul>
<p>These operations might require specific authorizations defined within Software Factory’s policy engine.</p>
<p>You can refer to sfmanager’s contextual help for more details.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operator/index.html" class="btn btn-neutral float-right" title="Operator documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="zuul_user.html" class="btn btn-neutral" title="Zuul pipelines and gating configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Red Hat.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>