

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Zuul pipelines and gating configuration &mdash; software-factory  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="software-factory  documentation" href="../index.html"/>
        <link rel="up" title="The Config repository" href="index.html"/>
        <link rel="next" title="Nodepool configuration" href="nodepool_user.html"/>
        <link rel="prev" title="Jenkins jobs configuration" href="jenkins_user.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> software-factory
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../main_components.html">Main components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Config repository</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="resources_user.html">Managing resources via the config repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="zuul3_user.html">Zuul3 user documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodepool3_user.html">Nodepool3 user documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="gerritbot_user.html">Gerritbot notification channels configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="gerrit_replication_user.html">Configure Gerrit git repositories replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="access_control_user.html">API access control</a></li>
<li class="toctree-l2"><a class="reference internal" href="gerritlinks_user.html">Gerrit comments link customisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="repoxplorer_user.html">RepoXplorer</a></li>
<li class="toctree-l2"><a class="reference internal" href="jenkins_user.html">Jenkins jobs configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Zuul pipelines and gating configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pipelines-default-configuration">Pipelines default configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-pipelines">Adding new pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-s-gate">Project’s gate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-a-job-as-non-voting">Configure a job as “Non Voting”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nodepool_user.html">Nodepool configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operator/index.html">Operator documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributor/index.html">Contributor documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">software-factory</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">The Config repository</a> &raquo;</li>
        
      <li>Zuul pipelines and gating configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/project_config/zuul_user.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning" id="zuul-user">
<p class="first admonition-title">Warning</p>
<p class="last">Zuul (v2) is deprecated and will be removed in Software Factory 3.0</p>
</div>
<div class="section" id="zuul-pipelines-and-gating-configuration">
<h1>Zuul pipelines and gating configuration<a class="headerlink" href="#zuul-pipelines-and-gating-configuration" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://docs.openstack.org/infra/zuul/">Zuul</a> is a software used to gate the
source code repository of a project so that changes are only merged if they pass tests.</p>
<p>Most of its configuration is available to Software Factory users through
the <strong>zuul</strong> directory in the <strong>config</strong> repository.</p>
<p>If you want a deeper understanding of Zuul then check the
<a class="reference external" href="http://docs.openstack.org/infra/zuul/">official documentation</a> and/or this
<a class="reference external" href="https://blogs.rdoproject.org/7542/dive-into-zuul-gated-commit-system-2">blog post</a>.</p>
<div class="section" id="pipelines-default-configuration">
<h2>Pipelines default configuration<a class="headerlink" href="#pipelines-default-configuration" title="Permalink to this headline">¶</a></h2>
<p>The default Zuul _layout.yaml provides five pipelines:</p>
<ul class="simple">
<li>The <strong>check</strong> pipeline: Is used to build a set of jobs
related to a Gerrit change (a submitted patch) and to report
a score (-1, or +1) in the <strong>Verified</strong> label according to the global tests results
within that buildset. This pipeline is managed by the <em>independent</em>
manager of Zuul.</li>
<li>The <strong>gate</strong> pipeline: Jobs can be configured to run in this pipeline
after a change has received all the required approvals.
This pipeline is managed by the <em>dependent</em> manager of Zuul and therefore acts
as a <a class="reference external" href="https://en.wikipedia.org/wiki/Gated_Commit">Gated Commit system</a>.</li>
<li>The <strong>post</strong> pipeline: Is used to build jobs
after a change has been merged into the master branch of a
repository. No score is given to the related change regardless of success
or failure. This pipeline is managed by the <em>independent</em> manager of Zuul.</li>
<li>The <strong>periodic</strong> pipeline: Is used to run periodic (a bit like a
cron job) jobs. Since these jobs are not related to a change, no
score is given either.
This pipeline is managed by the <em>independent</em> manager of Zuul.</li>
<li>The <strong>tag</strong> pipeline: Jobs are triggered after a tag is pushed on a
repository. Like the post and periodic pipelines, there is no score associated
to the results of these jobs.</li>
</ul>
</div>
<div class="section" id="adding-new-pipelines">
<h2>Adding new pipelines<a class="headerlink" href="#adding-new-pipelines" title="Permalink to this headline">¶</a></h2>
<p>To add a custom pipeline, create a new file, for example zuul/periodic.yaml:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">pipelines</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">monthly_periodic</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This pipeline run jobs every month</span>
    <span class="l l-Scalar l-Scalar-Plain">manager</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IndependentPipelineManager</span>
    <span class="l l-Scalar l-Scalar-Plain">precedence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">low</span>
    <span class="l l-Scalar l-Scalar-Plain">trigger</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">timer</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">time</span><span class="p p-Indicator">:</span> <span class="s">&#39;0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">\*&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">failure</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">smtp</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins@fqdn</span>
        <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dev-robot@fqdn</span>
        <span class="l l-Scalar l-Scalar-Plain">subject</span><span class="p p-Indicator">:</span> <span class="s">&#39;fqdn:</span><span class="nv"> </span><span class="s">Monthly</span><span class="nv"> </span><span class="s">periodic</span><span class="nv"> </span><span class="s">failed&#39;</span>
</pre></div>
</div>
<p>More informations about Zuul pipelines can be found
<a class="reference external" href="http://docs.openstack.org/infra/zuul/zuul.html#pipelines">here</a>.</p>
</div>
<div class="section" id="project-s-gate">
<span id="zuul-gate"></span><h2>Project’s gate<a class="headerlink" href="#project-s-gate" title="Permalink to this headline">¶</a></h2>
<p>To add gating to a repository, create a new file, for example zuul/project.yaml:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">projects</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">project-name</span>
    <span class="l l-Scalar l-Scalar-Plain">check</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">check-job1-name</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">check-job2-name</span>
    <span class="l l-Scalar l-Scalar-Plain">gate</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">gate-job1-name</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">gate-job2-name</span>
    <span class="l l-Scalar l-Scalar-Plain">periodic</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">periodic-job-name</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The jobs must be defined in the <strong>job</strong> directory as well, see <a class="reference internal" href="jenkins_user.html#jenkins-user"><span class="std std-ref">Job configuration</span></a>.</li>
<li>Check and gate jobs can be identical (and often are).</li>
</ul>
</div>
</div>
<div class="section" id="configure-a-job-as-non-voting">
<span id="non-voting-jobs"></span><h2>Configure a job as “Non Voting”<a class="headerlink" href="#configure-a-job-as-non-voting" title="Permalink to this headline">¶</a></h2>
<p>A test result for a patch determines if the patch is ready to be merged. Zuul
reports an evaluation on Gerrit at the end once the buildset has completed and if this result
is positive, then it allows the patch to be merged on the master branch of a project. But
it can be long and difficult to develop a new test that works as intended (stable,
no false positives, …) so a good practice is to first set the job as “Non Voting”.</p>
<p>For example, let’s assume a repository already runs one test job that is known as stable; this
job is used to determine whether a patch can be merged or not. Then you
want to add another experimental job, but you don’t want this new job to prevent the merge of
a patch. In that case you can configure Zuul (zuul/projects.yaml) as follows:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">jobs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">demo-job</span>
    <span class="l l-Scalar l-Scalar-Plain">branch</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
    <span class="l l-Scalar l-Scalar-Plain">voting</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>Zuul will then report the results of “demo-job” as a comment for the tested patch,
but failures won’t impact the “Verified” score.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nodepool_user.html" class="btn btn-neutral float-right" title="Nodepool configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jenkins_user.html" class="btn btn-neutral" title="Jenkins jobs configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Red Hat.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>